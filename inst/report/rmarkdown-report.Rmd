---
title: "cytosel Run Report"
output: 
  html_document:
    toc: true
    toc_float: true
params:
  df: ""
  marker_selection: ""
  heatmap: ""
  umap: ""
  metric: ""
  config: ""
  tmpdir: ""
---

<style>
.main-container {
    max-width: 940px;
    margin-right: auto;
}
</style>

Below are the results of your cytosel antibody panel design run.

```{r message=FALSE, echo=F}
knitr::opts_knit$set(root.dir = params$tmpdir)
library(tidyverse)
library(DT)
library(yaml)
library(shiny)
library(printr)
library(reactable)
library(plotly)
library(htmltools)
```


```{r, echo=FALSE}
htmltools::img(src = "cytosel-logo.png", 
               alt = 'logo', 
               style = 'position:absolute; top:0; right:0; padding-top: 20px; padding-right:40px; width: 185px;')
```
## Antibody panel

```{r message=F, echo=F, width = 13}
reactable(params$df,
                searchable = TRUE,
                filterable = TRUE,
                columns = list(`Host Species` = colDef(
                  filterInput = function(values, name) {
                    tags$select(
                      # Set to undefined to clear the filter
                      onchange = sprintf("Reactable.setFilter('antibody-select', '%s', event.target.value || undefined)", name),
                      # "All" has an empty value to clear the filter, and is the default option
                      tags$option(value = "", "All"),
                      lapply(unique(values), tags$option),
                      "aria-label" = sprintf("Filter %s", name),
                      style = "width: 100%; height: 28px;"
                    )
                  }
                ),
                `Product Category Tier 3` = colDef(
                  filterInput = function(values, name) {
                    tags$select(
                      # Set to undefined to clear the filter
                      onchange = sprintf("Reactable.setFilter('antibody-select', '%s', event.target.value || undefined)", name),
                      # "All" has an empty value to clear the filter, and is the default option
                      tags$option(value = "", "All"),
                      lapply(unique(values), tags$option),
                      "aria-label" = sprintf("Filter %s", name),
                      style = "width: 100%; height: 28px;"
                    )
                  }
                ),
                `External Link` = colDef(html = T)
                ),
                sortable = TRUE,
                elementId = "antibody-select")
```

## Selected markers

You selected the following markers to be included in your antibody panel.

```{r message=FALSE, echo=F, results = 'asis'}

cat(paste0("- `", params$marker_selection, "`"), sep = "\n")
```

## Heatmaps

```{r echo=F, warning=F}
params$heatmap
```

## UMAPs {.tabset}

### All Markers

```{r echo = F, fig.width=8, fig.height=5, warning=F, message=F}
params$umap$all

```

### Selected Marker Panel

```{r echo = F, fig.width=8, fig.height=5, warning=F, message=F}
params$umap$top

```


## Metrics {.tabset}

### Distribution

```{r echo=F, warning=F, fig.width=10}
params$metric$plot
```


### Summary Table

```{r echo=F, warning=F, fig.width=10}
params$metric$table |> 
  datatable(options = list(autoWidth = FALSE))
```


## Config

Below is the configuration used during your run:

```{r echo = F,message=F}
params$config |> 
  datatable(options = list(autoWidth = FALSE))
```
